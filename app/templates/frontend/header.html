<!-- ============================== -->
<!-- Header: Fixed Navigation Bar -->
<!-- ============================== -->
<header class="fixed top-0 inset-x-0 z-50 bg-white dark:bg-gray-900 shadow border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16 relative">
  
        <!-- ========== Brand Logo ========== -->
        <a href="/" class="flex items-center space-x-2">
          <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <!-- Gradient Fill -->
              <linearGradient id="grad1" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#00C896"/>
                <stop offset="100%" stop-color="#00FFA3"/>
              </linearGradient>
              <!-- Drop Shadow -->
              <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#00FFA3" flood-opacity="0.4"/>
              </filter>
            </defs>
            <!-- Logo Graphic -->
            <g filter="url(#shadow)">
              <path d="M20 10 C40 10, 40 50, 20 50 C0 50, 0 30, 20 30 C40 30, 40 10, 20 10 Z M20 20 C30 20, 30 40, 20 40 C10 40, 10 30, 20 30 Z" fill="url(#grad1)"/>
              <path d="M5 15 Q3 25 5 35" stroke="#00C896" stroke-width="3" fill="none"/>
              <path d="M35 15 Q37 25 35 35" stroke="#00C896" stroke-width="3" fill="none"/>
            </g>
          </svg>
        </a>
  
        <!-- ========== Desktop Navigation & Search ========== -->
        <div class="hidden md:flex items-center space-x-4">
  
          <!-- ----- Search Input with Icon ----- -->
          <div class="relative">
            <!-- Search Icon -->
            <div class="absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-300 pointer-events-none">
              <svg class="h-5 w-5 mt-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1010.5 18a7.5 7.5 0 006.15-1.35z"/>
              </svg>
            </div>
  
            <!-- Search Field -->
            <input
              id="searchInput"
              type="text"
              placeholder="Search..."
              autocomplete="off"
              class="mt-1 focus:w-[28rem] pl-10 px-2 py-1 rounded bg-gray-100 dark:bg-gray-800 text-black dark:text-white shadow-inner focus:outline-none focus:ring-2 focus:ring-green-300 transition-width focus:w-96"
            >
  
            <!-- Dropdown: Search Results -->
            <ul
              id="desktopResultsDropdown"
              class="absolute top-full w-[28rem] right-0 bg-white dark:bg-gray-800 text-black dark:text-white border border-gray-200 dark:border-gray-700 rounded shadow mt-1 hidden z-50 max-h-60 overflow-y-auto"
            >
              <!-- Results populated via JS -->
            </ul>
          </div>
  
          <!-- Quizzes Link -->
          <a href="#quiz-preview" class="text-sm bg-green-600 text-white px-4 py-1 rounded shadow hover:bg-green-700">Quizzes</a>
  
          <!-- Dark Mode Toggle -->
          <button onclick="toggleDarkMode()" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-2 py-1 rounded shadow hover:opacity-80">
            <span id="darkModeIconDesktop">ðŸŒ™</span>
          </button>
  
          <!-- Sign In Button -->
          <a href="/signin" class="text-sm bg-blue-600 text-white px-4 py-1 rounded shadow hover:bg-blue-700">Sign In</a>
        </div>
  
        <!-- ========== Mobile Navigation Buttons ========== -->
        <div class="flex md:hidden items-center space-x-2">
          <!-- Toggle Search -->
          <button onclick="toggleMobileSearch()" class="p-2 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1010.5 18a7.5 7.5 0 006.15-1.35z"/>
            </svg>
          </button>
  
          <!-- Quiz Link -->
          <a href="#quiz-preview" class="bg-green-600 text-white px-3 py-1 rounded shadow text-sm hover:bg-green-700">Quiz</a>
  
          <!-- Toggle Dark Mode -->
          <button onclick="toggleDarkMode()" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-2 py-1 rounded shadow hover:opacity-80">ðŸŒ™</button>
  
          <!-- Sign In -->
          <a href="/signin" class="bg-blue-600 text-white px-3 py-1 rounded shadow text-sm hover:bg-blue-700">Sign In</a>
        </div>
  
        <!-- ========== Mobile Search Overlay ========== -->
        <div id="mobileSearchOverlay" class="hidden absolute top-0 left-0 w-full z-40 bg-white dark:bg-gray-900 p-3 border-b border-gray-300 dark:border-gray-700">
          <div class="flex items-center space-x-2">
            <!-- Search Input -->
            <input id="mobileSearchInput" type="text" placeholder="Search..." class="flex-1 px-3 py-2 rounded bg-gray-100 dark:bg-gray-800 text-black dark:text-white shadow-inner focus:outline-none focus:ring-2 focus:ring-green-400">
  
            <!-- Close Button -->
            <button onclick="toggleMobileSearch()" class="p-2 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 rounded">âœ–</button>
          </div>
  
          <!-- Mobile Results Dropdown -->
          <ul id="mobileResultsDropdown" class="absolute top-full left-0 right-0 bg-white dark:bg-gray-800 text-black dark:text-white border border-gray-200 dark:border-gray-700 rounded shadow mt-1 hidden z-50 max-h-60 overflow-y-auto">
            <!-- Results populated via JS -->
          </ul>
        </div>
      </div>
    </div>
  </header>
  
  <!-- ============================================ -->
  <!-- JavaScript: Search & Interaction Functions -->
  <!-- ============================================ -->
  <script>
    // DOM Elements
    const desktopSearchInput = document.getElementById("searchInput");
    const desktopResultsDropdown = document.getElementById("desktopResultsDropdown");
    const mobileSearchInput = document.querySelector("#mobileSearchOverlay input[type='text']");
    const mobileResultsDropdown = document.getElementById("mobileResultsDropdown");
  
    // Utility: Highlight matching query terms
    function highlightMatch(text, query) {
      const safeQuery = query.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      const regex = new RegExp(`(${safeQuery})`, "gi");
      return text.replace(regex, '<mark class="custom-highlight">$1</mark>');
    }
  
    // Render fetched results into dropdown list
    function renderResults(results, dropdownElement, query) {
      dropdownElement.innerHTML = "";
  
      if (results.length === 0) {
        const li = document.createElement("li");
        li.className = "px-4 py-2 text-sm text-gray-500";
        li.textContent = "No results found.";
        dropdownElement.appendChild(li);
        dropdownElement.classList.remove("hidden");
        return;
      }
  
      const topicsMap = new Map();
  
      results.forEach(result => {
        if (result.type === "topic") {
          topicsMap.set(result.id, { ...result, subtopics: [] });
        } else if (result.type === "subtopic") {
          if (!topicsMap.has(result.topic_id)) {
            topicsMap.set(result.topic_id, {
              id: result.topic_id,
              type: "topic",
              name: result.topic_name,
              slug: result.topic_slug,
              subtopics: [],
            });
          }
          topicsMap.get(result.topic_id).subtopics.push(result);
        }
      });
  
      // Render topics and subtopics
      for (const [, topic] of topicsMap) {
        const topicLi = document.createElement("li");
        topicLi.className = "px-4 py-2 font-semibold text-green-700 dark:text-green-300 hover:bg-green-100 dark:hover:bg-green-900 cursor-pointer transition";
        topicLi.innerHTML = `ðŸ“ ${highlightMatch(topic.name, query)}`;
        topicLi.onclick = () => window.location.href = `/${topic.slug}`;
        dropdownElement.appendChild(topicLi);
  
        topic.subtopics.forEach(sub => {
          const subLi = document.createElement("li");
          subLi.className = "px-4 py-2 text-sm pl-6 hover:bg-green-50 dark:hover:bg-green-800 cursor-pointer transition";
          subLi.innerHTML = `ðŸ“˜ ${highlightMatch(sub.name, query)}`;
          subLi.onclick = () => window.location.href = `/python/${sub.subtopic_slug}`;
          dropdownElement.appendChild(subLi);
        });
      }
  
      dropdownElement.classList.remove("hidden");
    }
  
    // Perform search request to backend API
    async function performSearch(query, dropdownElement) {
      const trimmedQuery = query.trim().toLowerCase();
      if (!trimmedQuery) {
        dropdownElement.classList.add("hidden");
        return;
      }
  
      try {
        const response = await fetch(`/api/v1/topics/search?q=${encodeURIComponent(trimmedQuery)}`);
        if (!response.ok) throw new Error("Network response was not ok");
        const results = await response.json();
        renderResults(results, dropdownElement, trimmedQuery);
      } catch (error) {
        console.error("Search error:", error);
        dropdownElement.classList.add("hidden");
      }
    }
  
    // Event: Desktop Search Input
    desktopSearchInput.addEventListener("input", function () {
      performSearch(this.value, desktopResultsDropdown);
    });
  
    // Event: Mobile Search Input
    if (mobileSearchInput && mobileResultsDropdown) {
      mobileSearchInput.addEventListener("input", function () {
        performSearch(this.value, mobileResultsDropdown);
      });
    }
  
    // Hide dropdowns when clicking outside
    document.addEventListener("click", function (e) {
      if (!desktopSearchInput.contains(e.target) && !desktopResultsDropdown.contains(e.target)) {
        desktopResultsDropdown.classList.add("hidden");
      }
      if (mobileSearchInput && mobileResultsDropdown) {
        if (!mobileSearchInput.contains(e.target) && !mobileResultsDropdown.contains(e.target)) {
          mobileResultsDropdown.classList.add("hidden");
        }
      }
    });
  </script>
  